<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CTV NFT Tracker</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">

  
  <!-- Theme style -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="hold-transition  dark-mode" x-data="alpineInstance()" x-init="fetchJpgStore()">
<div class="wrapper">



  <!-- Content Wrapper. Contains page content -->
  <div>
    <!-- Main content -->
    <section class="content">
      <div class="container-fluid" x-data="collection">
        <div class="row">

            <!-- /.col -->
            <div class="ml-auto mr-3">
              <div class="info-box">
                <span class="info-box-icon bg-success"><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM228 104c0-11-9-20-20-20s-20 9-20 20v14c-7.6 1.7-15.2 4.4-22.2 8.5c-13.9 8.3-25.9 22.8-25.8 43.9c.1 20.3 12 33.1 24.7 40.7c11 6.6 24.7 10.8 35.6 14l1.7 .5c12.6 3.8 21.8 6.8 28 10.7c5.1 3.2 5.8 5.4 5.9 8.2c.1 5-1.8 8-5.9 10.5c-5 3.1-12.9 5-21.4 4.7c-11.1-.4-21.5-3.9-35.1-8.5c-2.3-.8-4.7-1.6-7.2-2.4c-10.5-3.5-21.8 2.2-25.3 12.6s2.2 21.8 12.6 25.3c1.9 .6 4 1.3 6.1 2.1l0 0 0 0c8.3 2.9 17.9 6.2 28.2 8.4V312c0 11 9 20 20 20s20-9 20-20V298.2c8-1.7 16-4.5 23.2-9c14.3-8.9 25.1-24.1 24.8-45c-.3-20.3-11.7-33.4-24.6-41.6c-11.5-7.2-25.9-11.6-37.1-15l-.7-.2c-12.8-3.9-21.9-6.7-28.3-10.5c-5.2-3.1-5.3-4.9-5.3-6.7c0-3.7 1.4-6.5 6.2-9.3c5.4-3.2 13.6-5.1 21.5-5c9.6 .1 20.2 2.2 31.2 5.2c10.7 2.8 21.6-3.5 24.5-14.2s-3.5-21.6-14.2-24.5c-6.5-1.7-13.7-3.4-21.1-4.7V104z"></path></svg></span>
  
                <div class="info-box-content">
                  <span class="info-box-text">CTV Price</span>
                  <span class="info-box-number" x-text ="ctvPrice"></span>
                </div>
                <!-- /.info-box-content -->
              </div>
              <!-- /.info-box -->
            </div>
            <!-- /.col -->


            <!-- /.col -->
          </div>
        <h3 class="mt-4 mb-4">Vault Seekers</h3>

        <div class="row" >
           <!-- /.col -->
           <template x-for="(rarity, key) in VaultSeekers" :key="key">
          <div class="col">
            <!-- Widget: user widget style 1 -->
            <div class="card card-widget widget-user">
              <!-- Add the bg color to the header using any of the bg-* classes -->
              <div class="widget-user-header" :class="rarity.color">
                <h3 class="widget-user-username" x-text="rarity.DisplayName"></h3>
                <h5 class="widget-user-desc" x-text="key"></h5>
              </div>

              <div class="card-footer">
                <div class="row">
                  <div class="col-sm-4 border-right">
                    <div class="description-block">
                      <h5 class="description-header"><a  x-bind:href="rarity.url" x-text="rarity.floor" target="_blank"></a></h5>
                      <span class="description-text">Floor Price</span>
                    </div>
                    <!-- /.description-block -->
                  </div>
                  <!-- /.col -->
                  <div class="col-sm-4 border-right">
                    <div class="description-block">
                      <h5 class="description-header" x-text="rarity.staking_reward"></h5>
                      <span class="description-text" >Staking Reward</span>
                    </div>
                    <!-- /.description-block -->
                  </div>
                  <!-- /.col -->
                  <div class="col-sm-4">
                    <div class="description-block">
                      <h5 class="description-header" x-text="rarity.daysLeft"></h5>
                      <span class="description-text">Staking Days Left</span>
                    </div>
                    <!-- /.description-block -->
                  </div>
                  <!-- /.col -->
                </div>
                <!-- /.row -->
                <ul class="nav flex-column">
                  <li class="nav-item">
                    <a  class="nav-link">
                        Staking left at current level <span class="float-right badge bg-primary" x-text="rarity.FutureCTV"></span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link">
                      Cost per CTV at current price <span class="float-right badge bg-success" x-text="rarity.costAtCurrentPrice"></span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link">
                      Days to ROI <span class="float-right badge bg-info" x-text="rarity.daysROI"></span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link">
                      Days to ROI at ATH (0.083)<span class="float-right badge bg-danger" x-text="rarity.daysRoiATH"></span>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
            <!-- /.widget-user -->
          </div>
        </template>

          <!-- /.col -->
        </div>
        <!-- /.row -->

        <h3 class="mt-4 mb-4">Earth Node + Chamber Key</h3>

        <div class="row" >
           <!-- /.col -->
           <template x-for="(rarity, key) in EarthVault" :key="key">
          <div class="col">
            <!-- Widget: user widget style 1 -->
            <div class="card card-widget widget-user">
              <!-- Add the bg color to the header using any of the bg-* classes -->
              <div class="widget-user-header" :class="rarity.color">
                <h3 class="widget-user-username" x-text="rarity.DisplayName"></h3>
                <h5 class="widget-user-desc" x-text="key"></h5>
              </div>

              <div class="card-footer">
                <div class="row">
                  <div class="col border-right">
                    <div class="description-block">
                      <h5 class="description-header"><a  x-bind:href="rarity.url" x-text="rarity.floor" target="_blank"></a></h5>
                      <span class="description-text">Floor Price</span>
                    </div>
                    <!-- /.description-block -->
       
                </div>

              </div>
            </div>
            <!-- /.widget-user -->
          </div>
        </template>
        <template x-for="(rarity, key) in ChamberKey" :key="key">
          <div class="col">
            <!-- Widget: user widget style 1 -->
            <div class="card card-widget widget-user">
              <!-- Add the bg color to the header using any of the bg-* classes -->
              <div class="widget-user-header" :class="rarity.color">
                <h3 class="widget-user-username" x-text="rarity.DisplayName"></h3>
                <h5 class="widget-user-desc" x-text="key"></h5>
              </div>

              <div class="card-footer">
                <div class="row">
                  <div class="col border-right">
                    <div class="description-block">
                      <h5 class="description-header"><a  x-bind:href="rarity.url" x-text="rarity.floor" target="_blank"></a></h5>
                      <span class="description-text">Floor Price</span>
                    </div>
                    <!-- /.description-block -->
                  </div>
                  <!-- /.col -->
          
                </div>
                <!-- /.row -->
              </div>
            </div>
            <!-- /.widget-user -->
          </div>
        </template>

          <!-- /.col -->
        </div>
        </div>

    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->
</div>

</body>
</html>

<script>

async function loader(item, nftType, loader) {
    let url = `https://server.jpgstoreapis.com/search/tokens?policyIds=${item.policyId}&saleType=default&sortBy=price-low-to-high&traits=${item.traits}&listingTypes=ALL_LISTINGS&verified=default&size=1`;
                  let response = await fetch(url);
                        // Get today's date
              const today = new Date();
              // Get the future date
              const futureDate = new Date("2024-07-02");
              // Calculate the difference in milliseconds
              const difference = futureDate.getTime() - today.getTime();
              // Convert the difference to days
              const daysLeft = Math.ceil(difference / (1000 * 60 * 60 * 24));
                  if (!response.ok) {
                    loader.isLoadingJpg = false;
                    loader.isErrorJpg = true;
                    loader.errorJpg = `Error: ${response.status} - ${response.statusText}`
              } else {
                  let responseJson =  await response.json();
                  let cheapestItem = responseJson['tokens'][0]["listing_lovelace"];
                  let price = cheapestItem/1000000;
                  if (cheapestItem == undefined) 
                  {
                      price="None Listed";
                  }
                  item['floor'] = price;
                  item['asset_id'] = responseJson['tokens'][0]["asset_id"];;
                  item['url'] =  'https://www.jpg.store/asset/' + item['asset_id']; 
                  if (nftType == "VaultSeekers")
                      {
                          item['daysLeft'] = daysLeft;
                          item['FutureCTV'] = daysLeft * item['staking_reward'];
                          item['costAtCurrentPrice']=(item['floor']/item['FutureCTV']).toPrecision(4);
                          var dailyprofit = loader.collection['ctvPrice']*item['staking_reward'];
                          item['daysROI']= Math.ceil(item['floor']/dailyprofit);
                          var athProfit = 0.08316*item['staking_reward'];
                          item['daysRoiATH']= Math.ceil(item['floor']/athProfit);
                      }

              }

}

  function alpineInstance() {
      return {
          isLoadingJpg: false,
          isErrorJpg: false,
          errorJpg: '',

          walletSearch: localStorage.getItem("address") || '',
          isLoading: false,
          loaded: false,
          isError: false,
          error: '',

          async fetchJpgStore(){
            const apiUrl = 'https://ctvprice.cyclic.app/';
            var thisobj =this;
            
          await  fetch(apiUrl)
          .then(response => response.json()) // Parse the data as JSON
          .then(data => {
                          // Extract the ADA_CTV_price from the data
                          let rawPrice = data.prices.ADA_CTV_price;
              // Format the price to 4 decimal places
              thisobj.collection['ctvPrice']= parseFloat(rawPrice).toFixed(5);
              
          });
              this.isLoadingJpg = true;
              let jpgListings = [];
              let processedListings = [];


              let nftType = Object.keys(this.collection);
              for (let x = 0; x < nftType.length; x++) {

              let keys = Object.keys(this.collection[nftType[x]]);
  
              for (let i = 0; i < keys.length; i++) {
                  let item = this.collection[nftType[x]][keys[i]];
                  loader(item, nftType[x], this);

              this.isLoadingJpg = false;
                this.jpgLoaded = true;
              }}
          },
          collection: {
                    'ctvPrice':0,
                  'VaultSeekers': {
                      'Common': {
                          'DisplayName' : 'Vault Seeker',
                          'color': 'bg-info',
                          'staking_reward': 1,
                          'floor': 0,
                          'asset_id': 0,
                          'url': '',
                          'traits' : 'eyJ2YXVsdCB0eXBlIjpbImNvbW1vbiJdfQ%3D%3D',
                          policyId: '1c9cc348fcb844ba233b1d9582d177a99c25b0117cbb4ca14b9bcebb'
                      },
                      'Uncommon': {
                          'DisplayName' : 'Vault Seeker',
                          'color': 'bg-secondary',
                          'staking_reward': 5,
                          'floor': 0,
                          'asset_id': 0,
                          'url': '',
                          'traits' : 'eyJ2YXVsdCB0eXBlIjpbInVuY29tbW9uIl19',
                          policyId: '1c9cc348fcb844ba233b1d9582d177a99c25b0117cbb4ca14b9bcebb'
                      },
                      'Gold': {
                          'DisplayName' : 'Vault Seeker',
                          'color': 'bg-primary',
                          'staking_reward': 10,
                          'floor': 0,
                          'asset_id': 0,
                          'url': '',
                          'traits' : 'eyJ2YXVsdCB0eXBlIjpbImdvbGQiXX0%3D',
                          policyId: '1c9cc348fcb844ba233b1d9582d177a99c25b0117cbb4ca14b9bcebb'
                      },
                      'Jewels': {
                          'DisplayName' : 'Vault Seeker',
                          'color': 'bg-success',
                          'staking_reward': 20,
                          'floor': 0,
                          'asset_id': 0,
                          'url': '',
                          'traits' : 'eyJ2YXVsdCB0eXBlIjpbImpld2VscyJdfQ%3D%3D',
                          policyId: '1c9cc348fcb844ba233b1d9582d177a99c25b0117cbb4ca14b9bcebb'
                      },
                      'Future': {
                          'DisplayName' : 'Vault Seeker',
                          'color': 'bg-warning',
                          'staking_reward': 100,
                          'floor': 0,
                          'asset_id': 0,
                          'url': '',
                          'traits' : 'eyJ2YXVsdCB0eXBlIjpbImZ1dHVyZSJdfQ%3D%3D',
                          policyId: '1c9cc348fcb844ba233b1d9582d177a99c25b0117cbb4ca14b9bcebb'
                      }},
                      "EarthVault":{
                      'EV': {
                          'DisplayName' : 'Earth Vault',
                          'color': 'bg-primary',
                          'floor': 0,
                          'asset_id': 0,
                          'url': '',
                          'traits' : '',
                          policyId: '2af4e8789778b79ddf25f2062377709e49181265d87beb2f99c902a4'
                      }},
                      "ChamberKey":{
                      'Member': {
                          'DisplayName' : 'Chamber Key - Member',
                          'color': 'bg-success',
                          'floor': 0,
                          'asset_id': 0,
                          'url': '',
                          'traits' : 'eyJjaGFtYmVyIGFjY2VzcyI6WyJtZW1iZXIiXX0%3D',
                          policyId: 'fb57afa1f178d13fdc7bb5609e8fae5859bae9e6d670278f9acbef90'
                      },
                      'Director': {
                          'DisplayName' : 'Chamber Key - Director',
                          'color': 'bg-warning',
                          'floor': 0,
                          'asset_id': 0,
                          'url': '',
                          'traits' : 'eyJjaGFtYmVyIGFjY2VzcyI6WyJkaXJlY3RvciJdfQ%3D%3D',
                          policyId: 'fb57afa1f178d13fdc7bb5609e8fae5859bae9e6d670278f9acbef90'
                      },
                      'Chair': {
                          'DisplayName' : 'Chamber Key - Chair',
                          'color': 'bg-danger',
                          'floor': 0,
                          'asset_id': 0,
                          'url': '',
                          'traits' : 'eyJjaGFtYmVyIGFjY2VzcyI6WyJjaGFpciJdfQ%3D%3D',
                          policyId: 'fb57afa1f178d13fdc7bb5609e8fae5859bae9e6d670278f9acbef90'
                      }

                  
              }
         }
         
      }
  }
</script>
